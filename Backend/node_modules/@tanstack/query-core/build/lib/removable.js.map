{"version":3,"file":"removable.js","sources":["../../src/removable.ts"],"sourcesContent":["import { isServer, isValidTimeout } from './utils'\n\nexport abstract class Removable {\n  gcTime!: number\n  #gcTimeout?: ReturnType<typeof setTimeout>\n\n  destroy(): void {\n    this.clearGcTimeout()\n  }\n\n  protected scheduleGc(): void {\n    this.clearGcTimeout()\n\n    if (isValidTimeout(this.gcTime)) {\n      this.#gcTimeout = setTimeout(() => {\n        this.optionalRemove()\n      }, this.gcTime)\n    }\n  }\n\n  protected updateGcTime(newGcTime: number | undefined): void {\n    // Default to 5 minutes (Infinity for server-side) if no gcTime is set\n    this.gcTime = Math.max(\n      this.gcTime || 0,\n      newGcTime ?? (isServer ? Infinity : 5 * 60 * 1000),\n    )\n  }\n\n  protected clearGcTimeout() {\n    if (this.#gcTimeout) {\n      clearTimeout(this.#gcTimeout)\n      this.#gcTimeout = undefined\n    }\n  }\n\n  protected abstract optionalRemove(): void\n}\n"],"names":["_classPrivateFieldLooseKey","Removable","destroy","clearGcTimeout","scheduleGc","isValidTimeout","gcTime","_classPrivateFieldLooseBase","setTimeout","optionalRemove","updateGcTime","newGcTime","Math","max","isServer","Infinity","clearTimeout","undefined"],"mappings":";;;;;AAAkD,IAAA,UAAA,gBAAAA,mDAAA,CAAA,WAAA,CAAA,CAAA;AAE3C,MAAeC,SAAS,CAAC;AAAA,EAAA,WAAA,GAAA;AAAA,IAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,UAAA,EAAA;AAAA,MAAA,QAAA,EAAA,IAAA;AAAA,MAAA,KAAA,EAAA,KAAA,CAAA;AAAA,KAAA,CAAA,CAAA;AAAA,GAAA;AAI9BC,EAAAA,OAAO,GAAS;IACd,IAAI,CAACC,cAAc,EAAE,CAAA;AACvB,GAAA;AAEUC,EAAAA,UAAU,GAAS;IAC3B,IAAI,CAACD,cAAc,EAAE,CAAA;AAErB,IAAA,IAAIE,oBAAc,CAAC,IAAI,CAACC,MAAM,CAAC,EAAE;MAC/BC,oDAAI,CAAA,IAAA,EAAA,UAAA,CAAA,CAAA,UAAA,CAAA,GAAcC,UAAU,CAAC,MAAM;QACjC,IAAI,CAACC,cAAc,EAAE,CAAA;AACvB,OAAC,EAAE,IAAI,CAACH,MAAM,CAAC,CAAA;AACjB,KAAA;AACF,GAAA;EAEUI,YAAY,CAACC,SAA6B,EAAQ;AAC1D;IACA,IAAI,CAACL,MAAM,GAAGM,IAAI,CAACC,GAAG,CACpB,IAAI,CAACP,MAAM,IAAI,CAAC,EAChBK,SAAS,IAATA,IAAAA,GAAAA,SAAS,GAAKG,cAAQ,GAAGC,QAAQ,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAClD,CAAA;AACH,GAAA;AAEUZ,EAAAA,cAAc,GAAG;AACzB,IAAA,IAAAI,oDAAA,CAAI,IAAI,EAAa,UAAA,CAAA,CAAA,UAAA,CAAA,EAAA;MACnBS,YAAY,CAAAT,oDAAA,CAAC,IAAI,EAAY,UAAA,CAAA,CAAA,UAAA,CAAA,CAAA,CAAA;AAC7B,MAAAA,oDAAA,CAAA,IAAI,4BAAcU,SAAS,CAAA;AAC7B,KAAA;AACF,GAAA;AAGF;;;;"}